<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Films - Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <div class="container">
        
        <h1>ğŸ¬ API de Films !</h1>
        <p class="subtitle">Explorez notre base de donnÃ©es de films</p>

        <div class="buttons">
            <button onclick="getTousLesFilms()">Tous les films</button>
            <button onclick="getTopRating()">Top 10 Rating</button>
            <button onclick="getStats()">Statistiques Budget</button>
        </div>

        <div class="genre-buttons">
            <h3>ğŸ­ Choisir un genre</h3>
            <button class="tag" onclick="getFilmsGenre('Action')">Action</button>
            <button class="tag" onclick="getFilmsGenre('Comedy')">Comedy</button>
            <button class="tag" onclick="getFilmsGenre('Horror')">Horror</button>
            <button class="tag" onclick="getFilmsGenre('Romance')">Romance</button>
            <button class="tag" onclick="getFilmsGenre('Drama')">Drama</button>
            <button class="tag" onclick="getFilmsGenre('Science Fiction')">Sci-Fi</button>
            <button class="tag" onclick="getFilmsGenre('Thriller')">Thriller</button>
        </div>

        <h3>âš™ï¸ Recherche AvanncÃ©e</h3>
        <div class="advanced-search">
            <input type="number" id="yearInput" placeholder="AnnÃ©e (ex: 2010)">
            
            <select id="ratingInput">
                <option value="" selected>-- Note Min --</option>
                <option value="9">â­ 9+</option>
                <option value="8">â­ 8+</option>
                <option value="7">â­ 7+</option>
                <option value="6">â­ 6+</option>
                <option value="5">â­ 5+</option>
            </select>

            <button onclick="rechercheAvancee()">Valider</button>
        </div>

        <h3 class="mt-large">ğŸ” Recherche par Acteur</h3>
        <div class="search-box">
            <select id="actorSelect">
                <option value="" disabled selected>-- Choisir un acteur --</option>
                <option value="Tom Hanks">Tom Hanks</option>
                <option value="Brad Pitt">Brad Pitt</option>
                <option value="Leonardo DiCaprio">Leonardo DiCaprio</option>
                <option value="Johnny Depp">Johnny Depp</option>
                <option value="Robert Downey Jr.">Robert Downey Jr.</option>
                <option value="Scarlett Johansson">Scarlett Johansson</option>
                <option value="Tom Cruise">Tom Cruise</option>
                <option value="Will Smith">Will Smith</option>
                <option value="Emma Watson">Emma Watson</option>
            </select>
            <button onclick="rechercher()">Rechercher</button>
        </div>

        <div id="results" class="results"></div>

    </div>

    <script>
        const API_URL = 'http://localhost:5000';

        // 1. Tous les films
        function getTousLesFilms() {
            fetch(`${API_URL}/movies`)
                .then(r => r.json())
                .then(data => afficherResultats(data.movies, `ğŸ“½ï¸ Tous les films (${data.total})`))
                .catch(gererErreur);
        }

        // 2. Top Rating
        function getTopRating() {
            fetch(`${API_URL}/movies/top_rating`)
                .then(r => r.json())
                .then(data => {
                    let html = `<h2>ğŸ† Top 10 des meilleurs films</h2><div class="top-list">`;
                    data.top_movies.forEach((movie, index) => {
                        html += `<div class="top-item"><span class="rank">#${index+1}</span><div class="top-info"><h3>${movie.title}</h3><p>â­ ${movie.vote_average}/10</p></div></div>`;
                    });
                    html += '</div>';
                    document.getElementById('results').innerHTML = html;
                })
                .catch(gererErreur);
        }

        // 3. Genres (Correction NaN incluse)
        function getFilmsGenre(genre) {
            fetch(`${API_URL}/movies/genre/${genre}`)
                .then(r => r.text())
                .then(text => JSON.parse(text.replace(/NaN/g, "null")))
                .then(data => afficherResultats(data.movies, `ğŸ­ Genre : ${data.genre} (${data.total})`))
                .catch(gererErreur);
        }

        // 4. Stats (Avec Emojis)
        function getStats() {
            fetch(`${API_URL}/stats/budget`)
                .then(r => r.json())
                .then(data => {
                    document.getElementById('results').innerHTML = `
                    <h2>ğŸ“Š Statistiques sur le Budget</h2>
                    <div class="stats-grid">
                        <div class="stat-card"><h3>ğŸ’° Moyenne</h3><p>${(data.mean/1e6).toFixed(2)} M$</p></div>
                        <div class="stat-card"><h3>ğŸ“ˆ Maximum</h3><p>${(data.max/1e6).toFixed(2)} M$</p></div>
                        <div class="stat-card"><h3>ğŸ“‰ Minimum</h3><p>${(data.min/1e6).toFixed(2)} M$</p></div>
                        <div class="stat-card"><h3>ğŸ“Š MÃ©diane</h3><p>${(data.median/1e6).toFixed(2)} M$</p></div>
                    </div>`;
                })
                .catch(gererErreur);
        }

        // 5. Recherche AvancÃ©e
        function rechercheAvancee() {
            const year = document.getElementById('yearInput').value;
            const minRating = document.getElementById('ratingInput').value;
            
            let url = `${API_URL}/movies/search?limit=20`;
            if (year) url += `&year=${year}`;
            if (minRating) url += `&min_rating=${minRating}`;
            
            fetch(url)
                .then(r => r.json())
                .then(data => afficherResultats(data.movies, `ğŸ” Recherche AvancÃ©e (${data.total})`))
                .catch(gererErreur);
        }

        // 6. Recherche Acteur
        function rechercher() {
            const actor = document.getElementById('actorSelect').value;
            if (actor) {
                fetch(`${API_URL}/movies/${actor}`)
                    .then(r => r.json())
                    .then(data => afficherResultats(data.movies, `ğŸ” Films avec : ${actor} (${data.total})`))
                    .catch(gererErreur);
            } else {
                alert("Choisissez un acteur !");
            }
        }

        // Fonctions Utiles
        function afficherResultats(movies, titre) {
            let html = `<h2>${titre}</h2><div class="movies-grid">`;
            if (movies && movies.length > 0) {
                movies.forEach(movie => {
                    const date = movie.release_date ? movie.release_date : "Inconnue";
                    html += `<div class="movie-card"><h3>${movie.title}</h3><p>â­ ${movie.vote_average}/10</p><p>ğŸ“… ${date}</p></div>`;
                });
            } else {
                html += `<p>Aucun film trouvÃ©.</p>`;
            }
            html += '</div>';
            document.getElementById('results').innerHTML = html;
        }

        function gererErreur(e) {
            console.error(e);
            document.getElementById('results').innerHTML = `<p class="error">âŒ Erreur : ${e}</p>`;
        }
    </script>
</body>
</html>